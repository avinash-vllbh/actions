#!/usr/bin/env bash
set -euo pipefail

# take version param; fallback to npm env var; fallback to asking git
version=${1:-${npm_package_version:-$(git describe --tags --match 'v[[:digit:]]*')}}
version=${version%%.*} # strip all but major
: "${version:?}"

branch=v${version#v} # ensure 'v' prefix

>&2 echo "Pushing master with tags"
git push --follow-tags

>&2 echo "Pushing to major-version branch: $branch"
git push https://github.com/nodenv/actions master:"$branch"
