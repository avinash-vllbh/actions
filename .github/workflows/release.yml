name: Release
on:
  push: # only semver tags, excluding prereleases
    tags: 'v[0-9]+.[0-9]+.[0-9]+'

jobs:
  major-branch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: |
          tag=${tag#refs/tags/}
          major=${tag%%.*}
          git push origin HEAD:refs/heads/$major
        env:
          tag: ${{github.ref}}

  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: v${{ github.ref }}
